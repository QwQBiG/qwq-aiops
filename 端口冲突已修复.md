# ✅ 端口冲突问题已修复

## 问题描述

启动服务时出现端口冲突错误：

```
Error: Bind for 192.168.50.12:6379 failed: port is already allocated
```

## 解决方案

已修改以下端口配置，避免与本地服务冲突：

### 修改的端口

| 服务 | 原端口 | 新端口 | 说明 |
|------|--------|--------|------|
| **Redis** | 6379 | **6380** | 避免与本地 Redis 冲突 |
| **MySQL** | 3306 | **3307** | 避免与本地 MySQL 冲突 |
| **主服务** | 8080 | **8081** | 避免与其他服务冲突 |

### 其他修复

- ✅ 删除了 `version: '3.8'`（Docker Compose V2 不需要）

## 重新启动服务

```bash
# 停止现有容器
docker compose down

# 重新启动
docker compose up -d

# 查看状态
docker compose ps
```

## 访问地址

服务启动后，访问以下地址：

| 服务 | 地址 | 说明 |
|------|------|------|
| **前端界面** | http://localhost:8081 | 主界面 |
| **API 文档** | http://localhost:8081/api/docs | Swagger UI |
| **Prometheus** | http://localhost:9090 | 监控指标 |
| **Grafana** | http://localhost:3000 | 可视化面板 |
| **MySQL** | localhost:3307 | 数据库（用户名: qwq, 密码: change-this-password） |
| **Redis** | localhost:6380 | 缓存 |

## 连接数据库

如果需要连接 MySQL 或 Redis：

### MySQL

```bash
# 使用命令行连接
mysql -h 127.0.0.1 -P 3307 -u qwq -p

# 或使用 Docker 容器内的客户端
docker exec -it qwq-mysql mysql -u qwq -p
```

### Redis

```bash
# 使用命令行连接
redis-cli -h 127.0.0.1 -p 6380

# 或使用 Docker 容器内的客户端
docker exec -it qwq-redis redis-cli
```

## 如果还有端口冲突

如果其他端口也被占用，可以继续修改 `docker-compose.yml`：

```yaml
services:
  qwq:
    ports:
      - "8082:8080"  # 改为其他可用端口
  
  mysql:
    ports:
      - "3308:3306"  # 改为其他可用端口
  
  redis:
    ports:
      - "6381:6379"  # 改为其他可用端口
  
  prometheus:
    ports:
      - "9091:9090"  # 改为其他可用端口
  
  grafana:
    ports:
      - "3001:3000"  # 改为其他可用端口
```

## 验证服务

```bash
# 查看所有容器状态
docker compose ps

# 预期输出（所有服务都是 Up 状态）
NAME              IMAGE                    STATUS
qwq               qwq-aiops:latest         Up
qwq-mysql         mysql:8.0                Up (healthy)
qwq-redis         redis:7-alpine           Up
qwq-prometheus    prom/prometheus:latest   Up
qwq-grafana       grafana/grafana:latest   Up

# 查看日志
docker compose logs -f qwq

# 健康检查
curl http://localhost:8081/api/health
```

## 默认账号

- **用户名**: admin
- **密码**: admin123

⚠️ **重要**：首次登录后请立即修改密码！

---

**更新日期**：2025-12-07  
**状态**：✅ 已修复
