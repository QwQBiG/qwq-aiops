# qwq AIOps å¹³å° - éƒ¨ç½²éªŒè¯æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥

### 1. ç¯å¢ƒè¦æ±‚

- [x] **Docker Desktop** å·²å®‰è£…å¹¶è¿è¡Œ
  - Windows: Docker Desktop for Windows
  - ç‰ˆæœ¬è¦æ±‚: 20.10+
  - ç¡®ä¿ Docker æœåŠ¡æ­£åœ¨è¿è¡Œ

- [x] **Docker Compose** å¯ç”¨
  - V2 (æ¨è): `docker compose version`
  - V1 (å…¼å®¹): `docker-compose --version`

- [x] **ç³»ç»Ÿèµ„æº**
  - å¯ç”¨å†…å­˜: è‡³å°‘ 4GB
  - å¯ç”¨ç£ç›˜: è‡³å°‘ 10GB
  - CPU: 2 æ ¸å¿ƒä»¥ä¸Š

### 2. å¿…è¦æ–‡ä»¶æ£€æŸ¥

```bash
# è¿è¡Œæ£€æŸ¥è„šæœ¬
éƒ¨ç½²æ£€æŸ¥ä¿®å¤.bat
```

å¿…é¡»å­˜åœ¨çš„æ–‡ä»¶ï¼š
- [x] `docker-compose.yml` - Docker ç¼–æ’é…ç½®
- [x] `Dockerfile` - å®¹å™¨æ„å»ºæ–‡ä»¶
- [x] `.env` - ç¯å¢ƒå˜é‡é…ç½®ï¼ˆä» .env.example å¤åˆ¶ï¼‰
- [x] `go.mod` - Go ä¾èµ–ç®¡ç†
- [x] `frontend/package.json` - å‰ç«¯ä¾èµ–
- [x] `cmd/qwq/main.go` - åç«¯å…¥å£
- [x] `config/prometheus.yml` - Prometheus é…ç½®
- [x] `config/mysql.cnf` - MySQL é…ç½®

### 3. AI æœåŠ¡é…ç½®

**å¿…é¡»é…ç½® AI æœåŠ¡æ‰èƒ½æ­£å¸¸è¿è¡Œï¼**

#### æ–¹å¼ 1: OpenAI APIï¼ˆæ¨èæ–°æ‰‹ï¼‰

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# å–æ¶ˆæ³¨é‡Šå¹¶å¡«å†™
AI_PROVIDER=openai
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-3.5-turbo
```

#### æ–¹å¼ 2: Ollama æœ¬åœ°æ¨¡å‹ï¼ˆæ¨èä¼ä¸šï¼‰

1. å®‰è£… Ollama: https://ollama.com/download
2. ä¸‹è½½æ¨¡å‹: `ollama pull qwen2.5:7b`
3. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# å–æ¶ˆæ³¨é‡Šå¹¶å¡«å†™
AI_PROVIDER=ollama
OLLAMA_HOST=http://host.docker.internal:11434
OLLAMA_MODEL=qwen2.5:7b
```

### 4. ç«¯å£æ£€æŸ¥

ç¡®ä¿ä»¥ä¸‹ç«¯å£æœªè¢«å ç”¨ï¼š

```bash
# Windows æ£€æŸ¥ç«¯å£
netstat -ano | findstr "8081"
netstat -ano | findstr "3308"
netstat -ano | findstr "6380"
netstat -ano | findstr "9091"
netstat -ano | findstr "3000"
```

ç«¯å£æ˜ å°„ï¼š
- `8081` â†’ qwq ä¸»æœåŠ¡ï¼ˆå‰ç«¯ + APIï¼‰
- `3308` â†’ MySQL æ•°æ®åº“
- `6380` â†’ Redis ç¼“å­˜
- `9091` â†’ Prometheus ç›‘æ§
- `3000` â†’ Grafana å¯è§†åŒ–

å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„ã€‚

### 5. ç½‘ç»œè¿æ¥æµ‹è¯•

```bash
# æµ‹è¯• Docker Hub
curl -I https://hub.docker.com

# æµ‹è¯• Go ä»£ç†
curl -I https://goproxy.cn

# æµ‹è¯• npm é•œåƒ
curl -I https://registry.npmmirror.com
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. è¿è¡Œæ£€æŸ¥è„šæœ¬
éƒ¨ç½²æ£€æŸ¥ä¿®å¤.bat

# 2. å¯åŠ¨æœåŠ¡
start.bat
```

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. åˆ›å»º .env æ–‡ä»¶
copy .env.example .env

# 2. ç¼–è¾‘ .env é…ç½® AI æœåŠ¡
notepad .env

# 3. åˆ›å»ºé…ç½®ç›®å½•
mkdir config

# 4. åœæ­¢ç°æœ‰å®¹å™¨
docker compose down

# 5. æ„å»ºå¹¶å¯åŠ¨
docker compose up -d --build
```

### é¦–æ¬¡æ„å»ºæ—¶é—´

- é¢„è®¡æ—¶é—´: 6-10 åˆ†é’Ÿ
- ä¸»è¦è€—æ—¶: 
  - ä¸‹è½½åŸºç¡€é•œåƒ (node, golang, alpine)
  - å®‰è£…å‰ç«¯ä¾èµ– (npm install)
  - ä¸‹è½½ Go ä¾èµ– (go mod download)
  - ç¼–è¯‘å‰ç«¯ (npm run build)
  - ç¼–è¯‘åç«¯ (go build)

## âœ… éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker compose ps

# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å®¹å™¨è¿è¡Œä¸­ï¼š
# - qwq (ä¸»æœåŠ¡)
# - qwq-mysql (æ•°æ®åº“)
# - qwq-redis (ç¼“å­˜)
# - qwq-prometheus (ç›‘æ§)
# - qwq-grafana (å¯è§†åŒ–)
```

### 2. æ£€æŸ¥æœåŠ¡å¥åº·

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8081/api/health

# åº”è¯¥è¿”å›ï¼š
# {"status":"ok","timestamp":"..."}
```

### 3. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ä¸»æœåŠ¡æ—¥å¿—
docker compose logs -f qwq

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker compose logs -f

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
docker compose logs --tail=100 qwq
```

### 4. è®¿é—®æœåŠ¡

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- **å‰ç«¯ç•Œé¢**: http://localhost:8081
- **API æ–‡æ¡£**: http://localhost:8081/api/docs
- **Prometheus**: http://localhost:9091
- **Grafana**: http://localhost:3000

é»˜è®¤è´¦å·ï¼š
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

### 5. æµ‹è¯• AI åŠŸèƒ½

ç™»å½•åæµ‹è¯• AI åŠŸèƒ½ï¼š
1. è¿›å…¥"æ™ºèƒ½è¯Šæ–­"é¡µé¢
2. è¾“å…¥æµ‹è¯•é—®é¢˜
3. æ£€æŸ¥ AI å“åº”æ˜¯å¦æ­£å¸¸

å¦‚æœ AI æ— å“åº”ï¼Œæ£€æŸ¥ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—ä¸­çš„ AI ç›¸å…³é”™è¯¯
docker compose logs qwq | findstr "AI"
docker compose logs qwq | findstr "error"
```

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: æ„å»ºå¤±è´¥ - ç½‘ç»œè¶…æ—¶

**ç—‡çŠ¶**: ä¸‹è½½ä¾èµ–æ—¶è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping goproxy.cn
ping registry.npmmirror.com

# 2. é‡è¯•æ„å»º
docker compose build --no-cache

# 3. å¦‚æœä»ç„¶å¤±è´¥ï¼Œä½¿ç”¨ä»£ç†
# ç¼–è¾‘ Dockerfileï¼Œå–æ¶ˆä»£ç†é…ç½®çš„æ³¨é‡Š
```

### é—®é¢˜ 2: ç«¯å£è¢«å ç”¨

**ç—‡çŠ¶**: `bind: address already in use`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr "8081"

# 2. ç»ˆæ­¢è¿›ç¨‹ï¼ˆæ›¿æ¢ PIDï¼‰
taskkill /PID <è¿›ç¨‹ID> /F

# 3. æˆ–ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£
# ä¾‹å¦‚: "8082:8080" æ”¹ä¸ºä½¿ç”¨ 8082 ç«¯å£
```

### é—®é¢˜ 3: AI æœåŠ¡æ— å“åº”

**ç—‡çŠ¶**: AI åŠŸèƒ½ä¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**:

**OpenAI æ–¹å¼**:
```bash
# 1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œç¡®è®¤ OPENAI_API_KEY

# 2. æµ‹è¯• API è¿æ¥
curl -H "Authorization: Bearer YOUR_API_KEY" https://api.openai.com/v1/models

# 3. é‡å¯æœåŠ¡
docker compose restart qwq
```

**Ollama æ–¹å¼**:
```bash
# 1. æ£€æŸ¥ Ollama æ˜¯å¦è¿è¡Œ
ollama list

# 2. æµ‹è¯•è¿æ¥
curl http://localhost:11434/api/tags

# 3. ç¡®è®¤æ¨¡å‹å·²ä¸‹è½½
ollama pull qwen2.5:7b

# 4. é‡å¯æœåŠ¡
docker compose restart qwq
```

### é—®é¢˜ 4: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

**ç—‡çŠ¶**: `docker compose ps` æ˜¾ç¤ºå®¹å™¨ Exited

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker compose logs qwq

# 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
# ç¡®è®¤ .env æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œæ²¡æœ‰è¯­æ³•é”™è¯¯

# 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker compose logs qwq-mysql

# 4. é‡æ–°æ„å»º
docker compose down
docker compose up -d --build
```

### é—®é¢˜ 5: å‰ç«¯é¡µé¢æ— æ³•è®¿é—®

**ç—‡çŠ¶**: æµè§ˆå™¨æ˜¾ç¤º "æ— æ³•è®¿é—®æ­¤ç½‘ç«™"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker compose ps

# 2. æ£€æŸ¥ç«¯å£æ˜ å°„
docker compose port qwq 8080

# 3. æ£€æŸ¥é˜²ç«å¢™
# Windows: å…è®¸ Docker Desktop é€šè¿‡é˜²ç«å¢™

# 4. å°è¯•ä½¿ç”¨ 127.0.0.1
# è®¿é—® http://127.0.0.1:8081 è€Œä¸æ˜¯ localhost
```

### é—®é¢˜ 6: Docker ç£ç›˜ç©ºé—´ä¸è¶³

**ç—‡çŠ¶**: `no space left on device`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker system prune -a

# 2. æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune

# 3. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
docker system df

# 4. å¢åŠ  Docker Desktop ç£ç›˜é™åˆ¶
# Docker Desktop â†’ Settings â†’ Resources â†’ Disk image size
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. èµ„æºé™åˆ¶è°ƒæ•´

ç¼–è¾‘ `docker-compose.yml`ï¼š

```yaml
deploy:
  resources:
    limits:
      cpus: '4'      # å¢åŠ  CPU é™åˆ¶
      memory: 4G     # å¢åŠ å†…å­˜é™åˆ¶
```

### 2. æ•°æ®åº“ä¼˜åŒ–

ç¼–è¾‘ `config/mysql.cnf`ï¼š

```ini
[mysqld]
innodb_buffer_pool_size=1G
max_connections=200
```

### 3. ç¼“å­˜é…ç½®

ç¼–è¾‘ `.env`ï¼š

```bash
ENABLE_CACHE=true
CACHE_TTL=600  # å¢åŠ ç¼“å­˜æ—¶é—´
```

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### æ›´æ–°æœåŠ¡

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 2. é‡æ–°æ„å»º
docker compose down
docker compose up -d --build
```

### å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½æ•°æ®åº“
docker compose exec qwq-mysql mysqldump -u root -p qwq > backup.sql

# å¤‡ä»½æ•°æ®ç›®å½•
xcopy /E /I data data_backup
```

### æŸ¥çœ‹èµ„æºä½¿ç”¨

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
docker system df
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—: `docker compose logs -f qwq`
2. æŸ¥çœ‹æ–‡æ¡£: `README.md`
3. æäº¤ Issue: https://github.com/QwQBiG/qwq-aiops/issues

## âœ¨ éƒ¨ç½²æˆåŠŸæ ‡å¿—

å½“çœ‹åˆ°ä»¥ä¸‹å†…å®¹æ—¶ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼š

1. âœ… æ‰€æœ‰å®¹å™¨çŠ¶æ€ä¸º `Up`
2. âœ… å¥åº·æ£€æŸ¥è¿”å› `{"status":"ok"}`
3. âœ… å¯ä»¥è®¿é—®å‰ç«¯ç•Œé¢
4. âœ… å¯ä»¥ç™»å½•ç³»ç»Ÿ
5. âœ… AI åŠŸèƒ½æ­£å¸¸å“åº”

**æ­å–œï¼qwq AIOps å¹³å°å·²æˆåŠŸéƒ¨ç½²ï¼** ğŸ‰
