# é…ç½®æ–‡ä»¶é—®é¢˜ä¿®å¤æŒ‡å—

## é—®é¢˜æè¿°

å¯åŠ¨æ—¶é‡åˆ°é”™è¯¯ï¼š

```
ERROR: for prometheus  Cannot start service prometheus: 
error mounting "/home/zbh/qwq-aiops/config/prometheus.yml" to rootfs
not a directory: Are you trying to mount a directory onto a file (or vice-versa)?
```

## åŸå› 

`config/prometheus.yml` å’Œ `config/mysql.cnf` æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒDocker å°è¯•æŒ‚è½½æ—¶å¤±è´¥ã€‚

## âœ… å·²ä¿®å¤

æˆ‘å·²ç»åˆ›å»ºäº†æ‰€éœ€çš„é…ç½®æ–‡ä»¶ï¼š

1. âœ… `config/prometheus.yml` - Prometheus ç›‘æ§é…ç½®
2. âœ… `config/mysql.cnf` - MySQL æ•°æ®åº“é…ç½®
3. âœ… `fix-config.sh` - Linux/macOS ä¿®å¤è„šæœ¬
4. âœ… `fix-config.bat` - Windows ä¿®å¤è„šæœ¬

## ğŸš€ ç°åœ¨å¯ä»¥å¯åŠ¨

### æ–¹æ³• 1ï¼šç›´æ¥å¯åŠ¨ï¼ˆæ¨èï¼‰

é…ç½®æ–‡ä»¶å·²ç»åˆ›å»ºå¥½äº†ï¼Œç›´æ¥å¯åŠ¨å³å¯ï¼š

```bash
# åœæ­¢ç°æœ‰å®¹å™¨
docker-compose down

# é‡æ–°å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f qwq
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ä¿®å¤è„šæœ¬

å¦‚æœé…ç½®æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œå¯ä»¥ä½¿ç”¨ä¿®å¤è„šæœ¬é‡æ–°åˆ›å»ºï¼š

**Linux/macOS**ï¼š
```bash
chmod +x fix-config.sh
./fix-config.sh
docker-compose up -d
```

**Windows**ï¼š
```cmd
fix-config.bat
docker-compose up -d
```

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### prometheus.yml

Prometheus ç›‘æ§é…ç½®ï¼Œç›‘æ§ä»¥ä¸‹æœåŠ¡ï¼š

- **prometheus** - Prometheus è‡ªèº«
- **qwq** - qwq ä¸»æœåŠ¡ï¼ˆç«¯å£ 8899ï¼‰
- **mysql** - MySQL æ•°æ®åº“
- **redis** - Redis ç¼“å­˜

### mysql.cnf

MySQL æ•°æ®åº“é…ç½®ï¼ŒåŒ…æ‹¬ï¼š

- å­—ç¬¦é›†ï¼šutf8mb4
- æ€§èƒ½ä¼˜åŒ–
- æ…¢æŸ¥è¯¢æ—¥å¿—
- äºŒè¿›åˆ¶æ—¥å¿—

## ğŸ” éªŒè¯å¯åŠ¨

å¯åŠ¨åï¼Œæ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# é¢„æœŸè¾“å‡º
NAME              IMAGE                    STATUS
qwq               qwq-aiops:latest         Up
qwq-mysql         mysql:8.0                Up (healthy)
qwq-redis         redis:7-alpine           Up
qwq-prometheus    prom/prometheus:latest   Up
qwq-grafana       grafana/grafana:latest   Up
```

## ğŸŒ è®¿é—®æœåŠ¡

æ‰€æœ‰æœåŠ¡å¯åŠ¨æˆåŠŸåï¼š

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| **qwq å‰ç«¯** | http://localhost:8081 | ä¸»ç•Œé¢ |
| **qwq API** | http://localhost:8081/api/docs | API æ–‡æ¡£ |
| **Prometheus** | http://localhost:9090 | ç›‘æ§æŒ‡æ ‡ |
| **Grafana** | http://localhost:3000 | å¯è§†åŒ–é¢æ¿ |
| **MySQL** | localhost:3306 | æ•°æ®åº“ |
| **Redis** | localhost:6379 | ç¼“å­˜ |

### é»˜è®¤è´¦å·

**qwq**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

**Grafana**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin`

**MySQL**ï¼š
- ç”¨æˆ·åï¼š`root` / `qwq`
- å¯†ç ï¼š`change-this-password`ï¼ˆéœ€è¦ä¿®æ”¹ï¼‰

## âš™ï¸ å¯é€‰æœåŠ¡

å¦‚æœæ‚¨ä¸éœ€è¦æŸäº›æœåŠ¡ï¼Œå¯ä»¥æ³¨é‡Šæ‰ `docker-compose.yml` ä¸­çš„ç›¸åº”éƒ¨åˆ†ï¼š

### åªå¯åŠ¨æ ¸å¿ƒæœåŠ¡

```bash
# åªå¯åŠ¨ qwq ä¸»æœåŠ¡
docker-compose up -d qwq

# æˆ–å¯åŠ¨ qwq + MySQL + Redis
docker-compose up -d qwq qwq-mysql qwq-redis
```

### ä¿®æ”¹ docker-compose.yml

æ³¨é‡Šæ‰ä¸éœ€è¦çš„æœåŠ¡ï¼š

```yaml
services:
  qwq:
    # ... qwq é…ç½® ...
    depends_on:
      # mysql:
      #   condition: service_healthy
      redis:
        condition: service_started

  # mysql:
  #   # ... MySQL é…ç½® ...

  redis:
    # ... Redis é…ç½® ...

  # prometheus:
  #   # ... Prometheus é…ç½® ...

  # grafana:
  #   # ... Grafana é…ç½® ...
```

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

```
Error: bind: address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„

```yaml
ports:
  - "8082:8080"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

### é—®é¢˜ 2ï¼šMySQL æ— æ³•å¯åŠ¨

```
ERROR: for qwq-mysql  Container is unhealthy
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æŸ¥çœ‹ MySQL æ—¥å¿—
docker-compose logs qwq-mysql

# åˆ é™¤æ•°æ®å·é‡æ–°åˆ›å»º
docker-compose down -v
docker-compose up -d
```

### é—®é¢˜ 3ï¼šPrometheus æ— æ³•è®¿é—® qwq

**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ qwq æœåŠ¡å·²å¯åŠ¨å¹¶æš´éœ²äº† `/metrics` ç«¯ç‚¹

```bash
# æµ‹è¯• metrics ç«¯ç‚¹
curl http://localhost:8081/metrics
```

### é—®é¢˜ 4ï¼šé…ç½®æ–‡ä»¶æƒé™é—®é¢˜

```
Permission denied
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ä¿®æ”¹é…ç½®æ–‡ä»¶æƒé™
chmod 644 config/prometheus.yml
chmod 644 config/mysql.cnf
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **[START_HERE.md](START_HERE.md)** - å¿«é€Ÿå¼€å§‹æŒ‡å—
- **[æœ€æ–°ä¼˜åŒ–æ€»ç»“.md](æœ€æ–°ä¼˜åŒ–æ€»ç»“.md)** - æ„å»ºä¼˜åŒ–
- **[docs/deployment-guide.md](docs/deployment-guide.md)** - å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ¯ ä¸‹ä¸€æ­¥

é…ç½®æ–‡ä»¶ä¿®å¤åï¼š

1. âœ… å¯åŠ¨æ‰€æœ‰æœåŠ¡
2. âœ… è®¿é—® http://localhost:8081
3. âœ… ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•ï¼ˆadmin / admin123ï¼‰
4. âœ… ä¿®æ”¹é»˜è®¤å¯†ç 
5. âœ… é…ç½® AI API Keyï¼ˆå¦‚éœ€ä½¿ç”¨ AI åŠŸèƒ½ï¼‰
6. âœ… æ¢ç´¢å„é¡¹åŠŸèƒ½

---

**ä¿®å¤æ—¶é—´**: 2025-12-07  
**çŠ¶æ€**: âœ… é…ç½®æ–‡ä»¶å·²åˆ›å»º  
**ä¸‹ä¸€æ­¥**: è¿è¡Œ `docker-compose up -d` å¯åŠ¨æœåŠ¡
