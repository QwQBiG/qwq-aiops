# 🚀 一键部署说明

## 使用方法

只需要运行一个命令：

```bash
chmod +x 一键部署.sh
sudo ./一键部署.sh
```

## 脚本功能

这个脚本会自动完成以下所有步骤：

1. ✅ **配置 Docker 国内镜像源**
   - 自动备份现有配置
   - 配置中科大、网易、百度、腾讯云镜像源
   - 重启 Docker 服务

2. ✅ **验证镜像源配置**
   - 检查镜像源是否生效

3. ✅ **创建配置文件**
   - 创建 `config/prometheus.yml`
   - 创建 `config/mysql.cnf`

4. ✅ **停止现有容器**
   - 清理旧的容器

5. ✅ **构建镜像**
   - 使用国内镜像源加速
   - 自动构建前端和后端

6. ✅ **启动服务**
   - 启动所有服务
   - 验证服务状态

## 预期时间

- **首次运行**：6-10 分钟（需要下载依赖和构建）
- **后续运行**：1-2 分钟（使用缓存）

## 成功后

脚本成功后，您会看到：

```
========================================
  部署成功！
========================================

访问地址：
  前端界面: http://localhost:8081
  API 文档: http://localhost:8081/api/docs
  Prometheus: http://localhost:9090
  Grafana: http://localhost:3000

默认账号：
  用户名: admin
  密码: admin123
```

## 查看日志

```bash
# 查看所有服务日志
docker-compose logs -f

# 只查看 qwq 主服务日志
docker-compose logs -f qwq

# 查看服务状态
docker-compose ps
```

## 如果失败

### 网络问题

如果提示网络错误，尝试：

```bash
# 测试网络连接
ping docker.io
curl -I https://docker.mirrors.ustc.edu.cn/v2/

# 手动拉取镜像
docker pull node:18-alpine
docker pull golang:1.23-alpine
docker pull alpine:3.19

# 然后重新运行脚本
sudo ./一键部署.sh
```

### 磁盘空间不足

```bash
# 检查磁盘空间
df -h

# 清理 Docker 缓存
docker system prune -a
```

### 权限问题

```bash
# 确保使用 sudo 运行
sudo ./一键部署.sh

# 或者将当前用户添加到 docker 组
sudo usermod -aG docker $USER
# 然后重新登录
```

## 停止服务

```bash
# 停止所有服务
docker-compose down

# 停止并删除数据卷
docker-compose down -v
```

## 重新部署

```bash
# 直接重新运行脚本即可
sudo ./一键部署.sh
```

## 只启动核心服务

如果不需要 Prometheus、Grafana 等监控服务：

```bash
# 只启动 qwq 主服务
docker-compose up -d qwq

# 或启动 qwq + MySQL + Redis
docker-compose up -d qwq qwq-mysql qwq-redis
```

## 常见问题

### Q1: 端口被占用

修改 `docker-compose.yml` 中的端口映射：

```yaml
ports:
  - "8082:8080"  # 改为其他端口
```

### Q2: 构建很慢

- 确保已配置 Docker 镜像源
- 检查网络连接
- 增加 Docker 资源（CPU、内存）

### Q3: 服务无法访问

```bash
# 检查服务状态
docker-compose ps

# 查看日志
docker-compose logs qwq

# 检查端口
netstat -tlnp | grep 8081
```

## 相关文档

- **[START_HERE.md](START_HERE.md)** - 快速开始指南
- **[Docker镜像源问题修复.md](Docker镜像源问题修复.md)** - 镜像源配置
- **[配置文件问题修复.md](配置文件问题修复.md)** - 配置文件说明

---

**一键部署，简单快捷！** 🎉
