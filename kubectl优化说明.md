# kubectl å®‰è£…ä¼˜åŒ–è¯´æ˜

## é—®é¢˜

kubectl ä¸‹è½½éå¸¸æ…¢ï¼Œå ç”¨äº† **274.8 ç§’ï¼ˆçº¦ 4.5 åˆ†é’Ÿï¼‰**çš„æ„å»ºæ—¶é—´ã€‚

## âœ… å·²ä¼˜åŒ–

### ä¼˜åŒ– 1ï¼šé»˜è®¤ä¸å®‰è£… kubectl

å¤§å¤šæ•°ç”¨æˆ·ä¸éœ€è¦ kubectlï¼Œæ‰€ä»¥ç°åœ¨**é»˜è®¤ä¸å®‰è£…**ï¼Œå¯ä»¥èŠ‚çœ 4-5 åˆ†é’Ÿçš„æ„å»ºæ—¶é—´ã€‚

```dockerfile
# é»˜è®¤ä¸å®‰è£…
ARG INSTALL_KUBECTL=false
```

### ä¼˜åŒ– 2ï¼šæ·»åŠ å›½å†…é•œåƒæº

å¦‚æœéœ€è¦å®‰è£… kubectlï¼Œä¼šå…ˆå°è¯•ä»é˜¿é‡Œäº‘é•œåƒä¸‹è½½ï¼Œå¤±è´¥åå†ä»å®˜æ–¹ä¸‹è½½ï¼š

```dockerfile
# å…ˆå°è¯•é˜¿é‡Œäº‘é•œåƒï¼ˆå¿«ï¼‰
wget https://kubernetes.oss-cn-hangzhou.aliyuncs.com/...
# å¤±è´¥åä½¿ç”¨å®˜æ–¹æºï¼ˆæ…¢ï¼‰
|| wget https://dl.k8s.io/...
```

## ğŸš€ ç°åœ¨æ„å»ºæ›´å¿«äº†

### ä¼˜åŒ–æ•ˆæœ

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|------|--------|--------|------|
| kubectl ä¸‹è½½ | 274.8 ç§’ | **0 ç§’** | **4.5 åˆ†é’Ÿ** |
| æ€»æ„å»ºæ—¶é—´ | 12-15 åˆ†é’Ÿ | **7-10 åˆ†é’Ÿ** | **5 åˆ†é’Ÿ** |

### é¢„æœŸæ„å»ºæ—¶é—´

ä¼˜åŒ–åçš„æ€»æ„å»ºæ—¶é—´ï¼š

1. **å‰ç«¯æ„å»º**ï¼š2-3 åˆ†é’Ÿ
2. **Go ä¾èµ–ä¸‹è½½**ï¼š1-2 åˆ†é’Ÿ
3. **Go ç¼–è¯‘**ï¼š2-3 åˆ†é’Ÿ
4. **è¿è¡Œæ—¶é•œåƒ**ï¼š1 åˆ†é’Ÿ
5. **kubectl ä¸‹è½½**ï¼š0 åˆ†é’Ÿï¼ˆè·³è¿‡ï¼‰

**æ€»è®¡**ï¼šçº¦ **6-9 åˆ†é’Ÿ**ï¼ˆæ¯”ä¹‹å‰å¿« 5 åˆ†é’Ÿï¼‰

## ğŸ“ å¦‚ä½•ä½¿ç”¨

### é»˜è®¤æ„å»ºï¼ˆä¸å®‰è£… kubectlï¼‰

```bash
# æ­£å¸¸æ„å»ºï¼Œä¸å®‰è£… kubectl
docker-compose build

# æˆ–ä½¿ç”¨è„šæœ¬
./rebuild.sh  # Linux/macOS
rebuild.bat   # Windows
```

### éœ€è¦ kubectl æ—¶

å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨ Kubernetes åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®šï¼š

```bash
# æ„å»ºæ—¶å®‰è£… kubectl
docker-compose build --build-arg INSTALL_KUBECTL=true

# æˆ–ä¿®æ”¹ docker-compose.yml
```

#### ä¿®æ”¹ docker-compose.yml

ç¼–è¾‘ `docker-compose.yml`ï¼Œæ·»åŠ æ„å»ºå‚æ•°ï¼š

```yaml
services:
  qwq:
    build:
      context: .
      args:
        INSTALL_KUBECTL: "true"  # å¯ç”¨ kubectl å®‰è£…
```

ç„¶åæ„å»ºï¼š

```bash
docker-compose build
```

## ğŸ¤” æˆ‘éœ€è¦ kubectl å—ï¼Ÿ

### ä¸éœ€è¦ kubectl çš„æƒ…å†µï¼ˆå¤§å¤šæ•°ç”¨æˆ·ï¼‰

- âœ… åªä½¿ç”¨ Docker å®¹å™¨ç®¡ç†
- âœ… åªä½¿ç”¨åº”ç”¨å•†åº—åŠŸèƒ½
- âœ… åªä½¿ç”¨ç½‘ç«™ç®¡ç†åŠŸèƒ½
- âœ… åªä½¿ç”¨æ•°æ®åº“ç®¡ç†åŠŸèƒ½
- âœ… å•æœºéƒ¨ç½²

### éœ€è¦ kubectl çš„æƒ…å†µ

- âŒ éœ€è¦ç®¡ç† Kubernetes é›†ç¾¤
- âŒ éœ€è¦éƒ¨ç½²åº”ç”¨åˆ° K8s
- âŒ éœ€è¦æŸ¥çœ‹ K8s èµ„æºçŠ¶æ€

## ğŸ’¡ å…¶ä»–ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨ Alpine åŒ…ç®¡ç†å™¨å®‰è£…ï¼ˆæœ€å¿«ï¼‰

å¦‚æœæ‚¨éœ€è¦ kubectlï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ apk å®‰è£…ï¼š

```bash
# è¿›å…¥å®¹å™¨
docker exec -it qwq sh

# å®‰è£… kubectlï¼ˆä» Alpine ä»“åº“ï¼Œå¾ˆå¿«ï¼‰
apk add kubectl
```

### 2. æŒ‚è½½å®¿ä¸»æœºçš„ kubectl

å¦‚æœå®¿ä¸»æœºå·²ç»å®‰è£…äº† kubectlï¼š

```yaml
services:
  qwq:
    volumes:
      - /usr/local/bin/kubectl:/usr/local/bin/kubectl:ro
```

### 3. ä½¿ç”¨è½»é‡çº§æ›¿ä»£å“

å¦‚æœåªéœ€è¦åŸºæœ¬çš„ K8s æ“ä½œï¼Œå¯ä»¥è€ƒè™‘ï¼š

- **k9s** - ç»ˆç«¯ UI å·¥å…·
- **kubectx** - å¿«é€Ÿåˆ‡æ¢é›†ç¾¤
- **stern** - æ—¥å¿—æŸ¥çœ‹å·¥å…·

## ğŸ” éªŒè¯ä¼˜åŒ–

æ„å»ºæ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
=> [stage-2 5/8] RUN if [ "false" = "true" ]; then ...
=> CACHED [stage-2 5/8] RUN if [ "false" = "true" ]; then ...
è·³è¿‡ kubectl å®‰è£…ï¼ˆåŠ å¿«æ„å»ºé€Ÿåº¦ï¼‰
```

å¦‚æœçœ‹åˆ° "è·³è¿‡ kubectl å®‰è£…"ï¼Œè¯´æ˜ä¼˜åŒ–ç”Ÿæ•ˆäº†ï¼

## ğŸ“Š æ„å»ºæ—¶é—´å¯¹æ¯”

### ä¼˜åŒ–å‰

```
=> [stage-2 5/8] RUN if [ "true" = "true" ]; then ...  274.8s
æ€»æ„å»ºæ—¶é—´: 12-15 åˆ†é’Ÿ
```

### ä¼˜åŒ–å

```
=> [stage-2 5/8] RUN if [ "false" = "true" ]; then ... 0.1s
æ€»æ„å»ºæ—¶é—´: 7-10 åˆ†é’Ÿ
```

**èŠ‚çœæ—¶é—´**ï¼šçº¦ **5 åˆ†é’Ÿ**

## ğŸ†˜ å¦‚æœéœ€è¦ kubectl

### æ–¹æ³• 1ï¼šæ„å»ºæ—¶å®‰è£…

```bash
docker-compose build --build-arg INSTALL_KUBECTL=true
```

### æ–¹æ³• 2ï¼šè¿è¡Œæ—¶å®‰è£…

```bash
# è¿›å…¥å®¹å™¨
docker exec -it qwq sh

# å®‰è£… kubectl
apk add kubectl

# æˆ–æ‰‹åŠ¨ä¸‹è½½
wget https://dl.k8s.io/release/v1.28.0/bin/linux/amd64/kubectl
chmod +x kubectl
mv kubectl /usr/local/bin/
```

### æ–¹æ³• 3ï¼šä½¿ç”¨å®¿ä¸»æœºçš„ kubectl

```bash
# åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œ kubectl å‘½ä»¤
kubectl get pods

# æˆ–é€šè¿‡ docker exec
docker exec qwq kubectl get pods
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **[æ„å»ºä¼˜åŒ–è¯´æ˜.md](æ„å»ºä¼˜åŒ–è¯´æ˜.md)** - å®Œæ•´çš„æ„å»ºä¼˜åŒ–
- **[NETWORK_FIX.md](NETWORK_FIX.md)** - ç½‘ç»œé—®é¢˜ä¿®å¤
- **[START_HERE.md](START_HERE.md)** - å¿«é€Ÿå¼€å§‹

## ğŸ¯ æ€»ç»“

- âœ… **é»˜è®¤ä¸å®‰è£… kubectl**ï¼ŒèŠ‚çœ 4-5 åˆ†é’Ÿæ„å»ºæ—¶é—´
- âœ… **éœ€è¦æ—¶å¯ä»¥å¯ç”¨**ï¼Œä½¿ç”¨ `--build-arg INSTALL_KUBECTL=true`
- âœ… **æ·»åŠ å›½å†…é•œåƒæº**ï¼Œå¦‚æœå¯ç”¨å®‰è£…ä¼šæ›´å¿«
- âœ… **æ€»æ„å»ºæ—¶é—´å‡å°‘åˆ° 7-10 åˆ†é’Ÿ**

---

**ä¼˜åŒ–æ—¶é—´**: 2025-12-07  
**çŠ¶æ€**: âœ… å·²ä¼˜åŒ–ï¼Œé»˜è®¤è·³è¿‡ kubectl å®‰è£…  
**æ•ˆæœ**: èŠ‚çœçº¦ 5 åˆ†é’Ÿæ„å»ºæ—¶é—´
