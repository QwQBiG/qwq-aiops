# ç«¯å£é…ç½®ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘ŠæœåŠ¡å¯åŠ¨åæ˜¾ç¤ºçš„ç«¯å£ä¸å®é™…é…ç½®ä¸ä¸€è‡´ï¼š

```
qwq  | [15:05:40] ğŸš€ qwq Dashboard started at http://localhost:8899
```

ä½†æ˜¯ docker-compose.yml é…ç½®çš„æ˜¯ï¼š
- å®¹å™¨å†…ç«¯å£: 8080
- å®¿ä¸»æœºç«¯å£: 8081

## ğŸ” é—®é¢˜åŸå› 

ä»£ç ä¸­å­˜åœ¨å¤šå¤„ç¡¬ç¼–ç çš„ç«¯å£å·ï¼š

### 1. cmd/qwq/main.go
```go
// æ—§ä»£ç 
server.Start(":8899")  // âŒ ç¡¬ç¼–ç  8899
```

### 2. internal/server/server.go
```go
// æ—§ä»£ç 
logger.Info("ğŸš€ qwq Dashboard started at http://localhost" + port)
// æ˜¾ç¤ºçš„æ˜¯ä¼ å…¥çš„ port å‚æ•°ï¼Œä½†æ²¡æœ‰æ­£ç¡®æ ¼å¼åŒ–
```

### 3. internal/gateway/*.go
```go
// ç¡¬ç¼–ç çš„æœåŠ¡æ³¨å†Œç«¯å£
gs.gateway.RegisterService("web-ui", "http://localhost:8899", ...)
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ä¸»ç¨‹åºç«¯å£è¯»å–

**æ–‡ä»¶**: `cmd/qwq/main.go`

```go
func runWebMode(cmd *cobra.Command, args []string) {
	server.TriggerPatrolFunc = performPatrol
	server.TriggerStatusFunc = sendSystemStatus
	go runPatrolLoop(8 * time.Hour)
	
	// âœ… ä»ç¯å¢ƒå˜é‡è¯»å–ç«¯å£ï¼Œé»˜è®¤ 8080
	port := os.Getenv("PORT")
	if port == "" {
		port = "8080"
	}
	server.Start(":" + port)
}
```

### 2. ä¿®å¤æ—¥å¿—æ˜¾ç¤º

**æ–‡ä»¶**: `internal/server/server.go`

```go
// âœ… æ­£ç¡®æ˜¾ç¤ºç«¯å£å·
displayPort := strings.TrimPrefix(port, ":")
logger.Info("ğŸš€ qwq Dashboard started at http://localhost:%s", displayPort)
```

### 3. ä¿®å¤ Gateway æ¨¡å¼

**æ–‡ä»¶**: `cmd/qwq/main.go`

```go
func runGatewayMode(cmd *cobra.Command, args []string) {
	// âœ… ä»ç¯å¢ƒå˜é‡è¯»å–ç«¯å£
	port := os.Getenv("PORT")
	if port == "" {
		port = "8080"
	}
	webUIPort := os.Getenv("WEB_UI_PORT")
	if webUIPort == "" {
		webUIPort = "8899"
	}
	
	gatewayServer := gateway.NewEnhancedGatewayServer(":" + port)
	// ...
}
```

## ğŸ“‹ é…ç½®éªŒè¯

### docker-compose.yml é…ç½®

```yaml
services:
  qwq:
    environment:
      - PORT=8080          # âœ… å®¹å™¨å†…ç«¯å£
    ports:
      - "8081:8080"        # âœ… å®¿ä¸»æœº:å®¹å™¨
```

### é¢„æœŸæ—¥å¿—è¾“å‡º

```
qwq  | [15:05:40] ğŸš€ qwq Dashboard started at http://localhost:8080
```

### è®¿é—®åœ°å€

- **å®¹å™¨å†…**: http://localhost:8080
- **å®¿ä¸»æœº**: http://localhost:8081

## ğŸ”„ é‡æ–°éƒ¨ç½²

ä¿®å¤åéœ€è¦é‡æ–°æ„å»ºï¼š

```bash
# åœæ­¢æœåŠ¡
docker compose down

# é‡æ–°æ„å»º
docker compose build --no-cache

# å¯åŠ¨æœåŠ¡
docker compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f qwq
```

## âœ¨ ä¿®å¤åçš„æ•ˆæœ

### æ­£ç¡®çš„æ—¥å¿—è¾“å‡º

```
qwq  | [15:05:40] æ­£åœ¨æ‰§è¡Œç³»ç»Ÿå·¡æ£€...
qwq  | [15:05:40] ğŸš€ qwq Dashboard started at http://localhost:8080
qwq  | [15:05:40] âœ” ç³»ç»Ÿå¥åº·
qwq  | [15:05:40] ğŸ“… å®šæ—¶ä»»åŠ¡å·²å¯åŠ¨: å·¡æ£€æ¯5åˆ†é’Ÿ, æ—¥æŠ¥æ¯8h0m0s
```

### å¥åº·æ£€æŸ¥

```bash
# å®¹å™¨å†…å¥åº·æ£€æŸ¥ï¼ˆDockerfile ä¸­é…ç½®ï¼‰
curl -f http://localhost:8080/health

# å®¿ä¸»æœºè®¿é—®
curl http://localhost:8081/api/health
```

## ğŸ“ å…¶ä»–ç«¯å£é…ç½®

å¦‚æœéœ€è¦ä¿®æ”¹ç«¯å£ï¼Œå¯ä»¥ç¼–è¾‘ docker-compose.ymlï¼š

```yaml
services:
  qwq:
    environment:
      - PORT=8080          # ä¿®æ”¹å®¹å™¨å†…ç«¯å£
    ports:
      - "8082:8080"        # ä¿®æ”¹å®¿ä¸»æœºç«¯å£ä¸º 8082
```

æˆ–è€…ä½¿ç”¨ .env æ–‡ä»¶ï¼š

```bash
# .env
PORT=8080
HOST_PORT=8081
```

```yaml
# docker-compose.yml
services:
  qwq:
    environment:
      - PORT=${PORT:-8080}
    ports:
      - "${HOST_PORT:-8081}:${PORT:-8080}"
```

## ğŸ¯ æ€»ç»“

ä¿®å¤å†…å®¹ï¼š
1. âœ… ç§»é™¤ç¡¬ç¼–ç çš„ 8899 ç«¯å£
2. âœ… ä»ç¯å¢ƒå˜é‡ PORT è¯»å–ç«¯å£é…ç½®
3. âœ… ä¿®å¤æ—¥å¿—æ˜¾ç¤ºæ ¼å¼
4. âœ… ç»Ÿä¸€å®¹å™¨å†…å¤–ç«¯å£é…ç½®

ç°åœ¨ç«¯å£é…ç½®å®Œå…¨ç”± docker-compose.yml å’Œç¯å¢ƒå˜é‡æ§åˆ¶ï¼Œä¸å†æœ‰ç¡¬ç¼–ç é—®é¢˜ã€‚

---

*ä¿®å¤æ—¶é—´: 2024-12-08*  
*å½±å“æ–‡ä»¶: cmd/qwq/main.go, internal/server/server.go*
