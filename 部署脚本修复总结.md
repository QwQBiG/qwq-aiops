# 🎯 部署脚本修复总结

## 修复日期
2025-12-08

## 问题描述

用户使用了错误的 `deploy.sh` 脚本进行部署，导致：
1. ❌ 没有配置 AI 服务
2. ❌ 端口不正确（8899 而非 8081）
3. ❌ 缺少完整的服务（MySQL、Redis、Prometheus）
4. ❌ 没有镜像源配置

## 修复措施

### 1. ✅ 删除错误的脚本

**删除文件**：`deploy.sh`

**原因**：
- 该脚本不支持 AI 配置
- 端口配置错误
- 功能不完整
- 容易误导用户

### 2. ✅ 更新 README.md

**修改内容**：

**修改前**：
```bash
# 3. 启动服务
chmod +x deploy.sh
./deploy.sh

# 4. 访问系统
# 前端界面: http://localhost:8081
```

**修改后**：
```bash
# 2. 运行一键部署脚本（会自动配置 AI 服务）
chmod +x 一键部署.sh
sudo ./一键部署.sh

# 3. 按提示选择 AI 服务类型
# 选项 1: OpenAI API（需要 API Key）
# 选项 2: Ollama 本地模型（免费）
# 选项 3: 跳过配置（稍后手动配置）

# 4. 访问系统
# 前端界面: http://localhost:8081
# API 文档: http://localhost:8081/api/docs
# Prometheus: http://localhost:9091
# Grafana: http://localhost:3000
```

**新增说明**：
- ✅ 脚本自动完成的功能列表
- ✅ AI 配置的重要性
- ✅ 正确的端口号
- ✅ 完整的服务列表

### 3. ✅ 更新 README_EN.md

同样更新了英文版 README，确保国际用户也能正确部署。

## 正确的部署方法

### 方法 1: 一键部署（推荐）

```bash
# 1. 克隆项目
git clone https://github.com/QwQBiG/qwq-aiops.git
cd qwq-aiops

# 2. 运行一键部署
chmod +x 一键部署.sh
sudo ./一键部署.sh

# 3. 按提示配置 AI
# 4. 等待部署完成
# 5. 访问 http://localhost:8081
```

### 方法 2: Docker Compose

```bash
# 1. 配置 AI 服务
chmod +x 配置AI服务.sh
./配置AI服务.sh

# 2. 启动服务
docker compose up -d --build

# 3. 访问 http://localhost:8081
```

## 两种脚本对比

| 特性 | ❌ deploy.sh (已删除) | ✅ 一键部署.sh |
|------|---------------------|---------------|
| AI 配置 | 不支持 | 支持 OpenAI/Ollama |
| 端口 | 8899 | 8081 |
| 镜像源配置 | 不支持 | 支持国内镜像源 |
| 完整服务 | 只有主服务 | MySQL、Redis、Prometheus、Grafana |
| 配置向导 | 无 | 交互式配置 |
| 配置备份 | 无 | 自动备份 |
| 连接测试 | 无 | Ollama 连接测试 |
| 健康检查 | 无 | 服务启动验证 |

## 用户需要做的

### 如果已经使用 deploy.sh 部署

```bash
# 1. 停止并删除旧容器
docker stop qwq
docker rm qwq

# 2. 使用正确的脚本重新部署
chmod +x 一键部署.sh
sudo ./一键部署.sh
```

### 如果还没有部署

直接使用正确的脚本：

```bash
chmod +x 一键部署.sh
sudo ./一键部署.sh
```

## 验证部署

### 1. 检查服务状态

```bash
docker compose ps
```

**预期输出**：
```
NAME              STATUS          PORTS
qwq               Up 2 minutes    0.0.0.0:8081->8080/tcp
qwq-mysql         Up 2 minutes    0.0.0.0:3308->3306/tcp
qwq-redis         Up 2 minutes    0.0.0.0:6380->6379/tcp
qwq-prometheus    Up 2 minutes    0.0.0.0:9091->9090/tcp
qwq-grafana       Up 2 minutes    0.0.0.0:3000->3000/tcp
```

### 2. 检查 AI 配置

```bash
docker compose logs qwq | grep -i "ai"
```

**预期输出**：
```
qwq  | AI Provider: openai
qwq  | AI Model: gpt-3.5-turbo
```

或

```
qwq  | AI Provider: ollama
qwq  | AI Host: http://host.docker.internal:11434
```

### 3. 访问服务

- ✅ 前端界面: http://localhost:8081
- ✅ API 文档: http://localhost:8081/api/docs
- ✅ Prometheus: http://localhost:9091
- ✅ Grafana: http://localhost:3000

### 4. 健康检查

```bash
curl http://localhost:8081/api/health
```

**预期返回**：
```json
{
  "status": "healthy",
  "version": "v1.0.0",
  "services": {
    "database": "healthy",
    "docker": "healthy",
    "ai": "healthy"
  }
}
```

## 文档更新清单

- [x] 删除 `deploy.sh` 脚本
- [x] 更新 `README.md` 部署说明
- [x] 更新 `README_EN.md` 部署说明
- [x] 添加脚本功能说明
- [x] 添加 AI 配置重要性说明
- [x] 更新端口号为 8081, 9091
- [x] 添加完整的服务列表

## 相关文档

- [快速开始.md](快速开始.md) - 快速部署指南
- [一键部署说明.md](一键部署说明.md) - 详细部署说明
- [AI配置说明.md](AI配置说明.md) - AI 配置详细说明
- [部署配置修复完成.md](部署配置修复完成.md) - 配置修复详情
- [部署配置验证清单.md](部署配置验证清单.md) - 验证清单

## 总结

✅ **已删除错误的 deploy.sh 脚本**  
✅ **已更新 README.md 和 README_EN.md**  
✅ **用户现在只能使用正确的部署方式**  
✅ **所有文档指向正确的脚本**

**现在用户不会再使用错误的脚本了！** 🎉

---

**重要提醒**：如果你已经使用 `deploy.sh` 部署，请停止容器并使用 `一键部署.sh` 重新部署！
